{% extends 'base/base-nav.html' %}

{% block title %} {{ title }} {% endblock %}

{% block extra_head %}
<script>
    function confirmUnsubscribe() {
        return confirm("Are you sure you want to delete this item?");
    }
</script>
{% endblock %}

{% block content %}
<div class="prose">
    <h1>{{ title }}</h1>
    {% if not active_subscriptions %}
    <p>No items found</p>
    {% endif %}
    <ul>
        {% for item in active_subscriptions %}
        <li>
            <div>
                <div class="flex gap-2">
                    <a href="{% url 'view_item' item.id %}">{{ item.name }}</a>
                    <span>|</span>
                    <form id="unsubscribe" method="post" action="{% url 'unsubscribe' item.id %}">
                        {% csrf_token %}
                        <button type="submit" onclick="return confirmUnsubscribe()">
                            <a>Unsubscribe</a>
                        </button>
                    </form>
                </div>
                <p>Reported by: <a href="{% url 'view_user' item.user.username %}">
                        {% if item.user.id == user.id %}
                        You
                        {% else %}
                        {{ item.user.username }}
                        {% endif %}
                    </a></p>
            </div>
            <ul>
                <img src="{{ item.image.url }}" alt="{{ item.name }}" class="w-32" />
                <li>Type: {{ item.type }}</li>
                <!-- latest comment on the item -->
                <li>Latest comment date: {{ item.latest_comment_date }}</li>
                <li>Latest comment: {{ item.latest_comment }}</li>
            </ul>
        </li>
        {% endfor %}
    </ul>
</div>
<div class="collapse bg-base-200">
    <input type="checkbox" />
    <div class="collapse-title text-xl font-medium">Show/hide archive</div>
    <div class="collapse-content">
        <div class="prose">
            {% if not inactive_subscriptions %}
            <p>No items found</p>
            {% endif %}
            <ul>
                {% for item in inactive_subscriptions %}
                <li>
                    <div>
                        <div class="flex gap-2">
                            <a href="{% url 'view_item' item.id %}">{{ item.name }}</a>
                            <span>|</span>
                            <form id="unsubscribe" method="post" action="{% url 'subscribe' item.id %}">
                                {% csrf_token %}
                                <button type="submit">
                                    <a>Subscribe</a>
                                </button>
                            </form>
                        </div>
                        <p>Reported by: <a href="{% url 'view_user' item.user.username %}">
                                {% if item.user.id == user.id %}
                                You
                                {% else %}
                                {{ item.user.username }}
                                {% endif %}
                            </a></p>
                    </div>
                    <ul>
                        <img src="{{ item.image.url }}" alt="{{ item.name }}" class="w-32" />
                        <li>Type: {{ item.type }}</li>
                        <!-- latest comment on the item -->
                        <li>Latest comment date: {{ item.latest_comment_date }}</li>
                        <li>Latest comment: {{ item.latest_comment }}</li>
                    </ul>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}